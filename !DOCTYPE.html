<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Management SPA - Firebase</title>
<style>
/* ... Keep your existing CSS for layout, cards, tables, modals ... */
body {font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:0;}
header {background:#004aad; color:white; padding:1rem; text-align:center;}
nav {display:flex; justify-content:center; margin:1rem 0;}
nav button {margin:0 0.5rem; padding:0.5rem 1rem; background:#004aad; color:white; border:none; border-radius:5px; cursor:pointer;}
nav button:hover {background:#003080;}
.container{max-width:1000px;margin:auto;padding:1rem;}
.card-container{display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-around;margin-bottom:1rem;}
.card{background:white;padding:1rem;border-radius:10px;flex:1;min-width:150px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
input, select, button{width:100%;padding:0.5rem;margin:0.3rem 0;border-radius:5px;border:1px solid #ccc;}
button{background:#004aad;color:white;border:none;cursor:pointer;}
button:hover{background:#003080;}
table{width:100%;border-collapse:collapse;margin-top:0.5rem;}
th, td{border:1px solid #ddd;padding:0.5rem;text-align:center;cursor:pointer;}
th{background:#004aad;color:white;}
.hidden{display:none;}
.search-box{margin-bottom:0.5rem;padding:0.5rem;border-radius:5px;border:1px solid #ccc;}
.grade-A {background-color:#4CAF50;color:white;}
.grade-B {background-color:#8BC34A;color:white;}
.grade-C {background-color:#FFEB3B;color:black;}
.grade-D {background-color:#FF9800;color:white;}
.grade-F {background-color:#F44336;color:white;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;}
.modal-content{background:white;padding:1rem;border-radius:10px;width:300px;position:relative;transform: translateY(-50px); opacity:0; transition: all 0.3s;}
.modal.show .modal-content{transform: translateY(0); opacity:1;}
.close{position:absolute;top:5px;right:10px;cursor:pointer;font-weight:bold;}
@media(max-width:768px){.card-container{flex-direction:column;} table, thead, tbody, th, td, tr{display:block;} th{position:sticky; top:0;} td{position:relative;padding-left:50%;} td::before{position:absolute; left:0;width:50%; white-space:nowrap; font-weight:bold;}}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<header><h1>School Management SPA - Firebase</h1></header>
<nav>
<button onclick="showTab('studentRegister')">Student Register/Login</button>
<button onclick="showTab('adminPanel')">Admin Panel</button>
</nav>

<div class="container">
<!-- Student Registration/Login -->
<div id="studentRegister">
<h2>Student Registration</h2>
<input placeholder="Name" id="regName">
<input placeholder="Student ID" id="regID">
<input placeholder="Class" id="regClass">
<input type="password" placeholder="Password" id="regPassword">
<button onclick="registerStudent()">Register</button>

<hr>
<h2>Student Login</h2>
<input type="text" id="loginID" placeholder="Enter Student ID">
<input type="password" id="loginPassword" placeholder="Enter Password">
<button onclick="studentLogin()">Login</button>

<div id="studentResults" class="hidden">
<h3>Welcome, <span id="studentNameCard"></span></h3>
<p>ID: <span id="studentIDCard"></span></p>
<p>Class: <span id="studentClassCard"></span></p>

<div class="card-container">
<div class="card">Total Grades: <span id="cardTotal"></span></div>
<div class="card">A Grades: <span id="cardA"></span></div>
<div class="card">B Grades: <span id="cardB"></span></div>
<div class="card">C Grades: <span id="cardC"></span></div>
<div class="card">D Grades: <span id="cardD"></span></div>
<div class="card">F Grades: <span id="cardF"></span></div>
</div>

<canvas id="gradesChart" height="150"></canvas>
<h4>My Grades Table</h4>
<button onclick="exportMyGradesCSV()">Download My Grades CSV</button>
<table id="myGradesTable">
<thead><tr><th>Course</th><th>Grade</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden">
<h2>Admin Dashboard</h2>
<div class="card-container">
<div class="card" id="totalStudents">Students: 0</div>
<div class="card" id="totalCourses">Courses: 0</div>
<div class="card" id="totalGrades">Grades: 0</div>
</div>
<h3>All Students</h3>
<input class="search-box" id="searchStudent" placeholder="Search students..." onkeyup="filterTable('studentsTable','searchStudent',1)">
<table id="studentsTable">
<thead><tr><th>Name</th><th>ID</th><th>Class</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<h3>All Courses</h3>
<input class="search-box" id="searchCourse" placeholder="Search courses..." onkeyup="filterTable('coursesTable','searchCourse',0)">
<table id="coursesTable">
<thead><tr><th>Course</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<h3>All Grades</h3>
<input class="search-box" id="searchGrade" placeholder="Search grades..." onkeyup="filterTable('gradesTable','searchGrade',0)">
<button onclick="exportGradesCSV()">Export Grades CSV</button>
<table id="gradesTable">
<thead><tr><th>Student</th><th>Course</th><th>Grade</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<button onclick="openModal('studentModal')">Add Student</button>
<button onclick="openModal('courseModal')">Add Course</button>
<button onclick="openModal('gradeModal')">Add Grade</button>
</div>

<!-- Modals ... keep same as previous SPA ... -->

<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Data Fetching from Firestore ---
let students=[], courses=[], grades=[];

async function loadData(){
    const sSnap = await db.collection('students').get();
    students = sSnap.docs.map(d=>d.data());
    const cSnap = await db.collection('courses').get();
    courses = cSnap.docs.map(d=>d.data());
    const gSnap = await db.collection('grades').get();
    grades = gSnap.docs.map(d=>d.data());
    updateTables();
}

// --- Save Data to Firestore ---
async function saveStudentToDB(student){
    await db.collection('students').doc(student.studentID).set(student);
}
async function saveCourseToDB(course){
    await db.collection('courses').doc(course.courseID).set(course);
}
async function saveGradeToDB(grade){
    await db.collection('grades').doc(grade.gradeID).set(grade);
}

// --- Admin Password protection ---
function showTab(tab){
    if(tab === 'adminPanel'){
        const pw = prompt("Enter Admin Password:");
        if(pw !== "Masesahe5"){ alert("Incorrect password!"); return; }
    }
    document.getElementById('studentRegister').classList.add('hidden');
    document.getElementById('adminPanel').classList.add('hidden');
    document.getElementById(tab).classList.remove('hidden');
}

// --- Continue your SPA functions (registerStudent, studentLogin, saveCourse, saveGrade, updateTables, updateMyGradesDashboard, etc.) ---
// In each function, after updating local arrays, call corresponding Firestore save functions.
// Example:
async function registerStudent(){
    const name=document.getElementById('regName').value;
    const id=document.getElementById('regID').value;
    const cls=document.getElementById('regClass').value;
    const pw=document.getElementById('regPassword').value;
    if(!name||!id||!cls||!pw){alert('All fields required'); return;}
    if(students.find(s=>s.studentID===id)){alert('ID exists'); return;}
    const student={name,studentID:id,class:cls,password:pw};
    students.push(student);
    await saveStudentToDB(student); // save online
    alert('Registered successfully!');
    document.getElementById('regName').value='';
    document.getElementById('regID').value='';
    document.getElementById('regClass').value='';
    document.getElementById('regPassword').value='';
    updateTables();
}

// --- Initialize ---
loadData();
showTab('studentRegister');
</script>
</body>
</html>
